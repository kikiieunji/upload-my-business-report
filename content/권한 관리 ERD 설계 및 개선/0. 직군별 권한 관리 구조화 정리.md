- 현재 급여 파트 작업 진행중
    - 어떤 사원은 임원진 급여까지 봐야하고 / 어떤 사원은 일반 사원까지만 볼 수 있는 권한이 주어져야함
    - 일반 사원은 임원진 급여를 볼 수 없어야 함

  

- 현재 구현되어 있는 부분
    - [소속 - 직군 - 부서 - 직책] : 소속이라는 이름으로 묶여 있음
    - `user` 테이블
        - `role` : ROLE_DEPT, ROLE_MANAGER, ROLE_ADMIN, ...
        - `user_role` : 1, 2, 3, 4, 5, ...
        - 현재 `role`은 직군과 비슷, 레거시한 개념

  

- 권한 관리 API를 급여 정산 API 와 연관지어 엔드포인트를 설계 하려고 함
- 어떤 관리자가 어떤 권한을 가져야할지 테이블 설계 필요

---

#### 설계 테이블

- `user(항목 존재)`
- `role`
    - `payroll_manager`
    - `accident_manager`
- `permission`
    - `read` : 1
    - `write` : 2 ( + 1 포함)

---

- `role_permission`
    - = `group_function` 참고
    - => permission_id
    - ex)

|role_id|permission_id|
|---|---|
|1|1|

- payroll_manager  가 permission_id = 1 일 경우 -> 읽기만 가능

|role_id|permission_id|
|---|---|
|payroll_manager|2|

- payroll_manager 가 permission_id = 2일 경우 -> 읽기/쓰기 모두 가능

  

- `user_scope` : 볼 수 있는 범위
- ex) 전산부 관리자가 임원진 급여까지 볼 수 있는 범위를 가지는
- id / user_id : 전산부 관리자 id / company_job_type id (회사 직군 매핑 id)
- role_permission 상관없이 내가 이사람들을 어디까지 볼 수 있는지에 대한 범위
    - `user` 테이블로 user 정보 확인 고려해볼 것
        - `user_department_position` 테이블을 사용하는 것은 무거운 느낌이 있음
    - 임원진 권한까지 접근한다고 했을 때 -> scope 매핑 고려 필요 (개별 ? or 묶어서)
    - ***개별 매핑**** 방향으로

  
  

- `user_role_permission` : 권한을 가지고 있는지 확인하기 위한 user 정보 테이블
    - = `udp_group_function` 참고

  

---

- API 호출 / 조회 (급여정산 직군별 권한 관리 예시)

| POST  /api/급여정산                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| - user_id 가 없이 들어온 경우<br>    - 접근을 거부할 수 있게 (role) -> 현재 로그인 유도중(exception) <br><br>             추후) CUSTOM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| - user_id가 확인된 경우 (하드 코딩)<br>    - user_role_permission 테이블에서 해당 user_id, role_permission_id 확인<br>    - role_permission 테이블에서 id 조회<br><br>             -> payroll_manager = read/write 권한 확인<br><br>- user_scope 테이블에서 권한 범위 확인<br><br>________________________________________________________________________________<br><br>endpoint(테이블 생성)<br><br>=> 이 url이 어떤 role에 해당하는지<br><br>급여정산 url 이 들어온 경우 -> 건드릴 수 있는 권한이 무엇인지 role_permission 을 가지고 -> role_permission + url = `end_point` 테이블<br><br>role_permission에서 권한 확인 -> payroll에 읽고 쓸수 있는 권한이 있네 => scope 에서 범위 확인하여 내가 여기까지 볼 수 있다 |

| GET /api/급여정산 (고려중)                                                                                                                                                                                            |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| - user_role_permission 테이블에서 user_id, role_permission_id 확인<br>- role_permission 테이블에서 조회<br><br>       -> payroll_manager = read 권한 확인<br><br>- user_scope 테이블에서 권한 범위 확인<br>- company_job_type 파라미터 먼저 들어와야함 |